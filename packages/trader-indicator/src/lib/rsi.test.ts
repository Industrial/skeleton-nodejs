import { describe, expect, test } from 'bun:test'

import { rsi } from './rsi.ts'

describe('rsi', () => {
  describe('When passed a length of 5 and an array of 1 to 20', () => {
    test('Should return the correct sequence', () => {
      const expected = [
        100, 100, 96.19094488189015, 96.04425768409675, 96.27241804962038, 96.33220611888021, 93.3229416284485,
        93.35421770416364, 93.53791979398613, 94.37186567483948, 88.00769883017514, 83.16873226489196,
        83.95720733326931, 82.03641887795806, 80.83514961618786, 72.3332640767659, 72.77163078242054, 71.59807366547128,
        72.75630878087586, 74.05188373209492, 71.0787453651067, 71.61264855324976, 72.44580903181793, 72.90760440164514,
        73.05359872228694, 73.50409418430516, 72.78186621833258, 70.21263151772548, 70.58770374868004,
        70.13094620014382, 69.39196315609696, 67.72563637807441, 67.70434696354098, 67.61639493026505,
        68.71984034919984, 69.74565465874646, 72.43955140752533, 66.29135192010898, 54.675152197193675,
        55.416079885663954, 54.50848208944145, 52.35999756082061, 38.653222169877765, 38.66554395302079,
        35.05961321484719, 36.51954759103683, 38.318728146722876, 40.259649298611706, 39.506852700734555,
        38.39288418878673, 40.26830103343876, 42.757122389665525, 45.365174398221015, 45.71066338981216,
        43.34481791371974, 44.073787835862866, 49.069457209897706, 48.25033439002121, 47.84659801866635,
        48.642657676862726, 49.93622676357009, 51.915028304085716, 58.637541580806165, 62.27908290555123,
        60.55560189433693, 63.50619089692917, 58.73662784225291, 57.682677428278005, 57.96762815813994,
        58.13427436117656, 59.295931152833276, 60.52404113442572, 57.13479407506836, 57.98385254555852,
        57.66874040248227, 71.04312121582002, 68.32496411028043, 70.1801974820385, 68.76377591575468, 80.23891107530929,
        78.4706871815157, 71.52628225249263, 71.602046257141, 65.81519971300645, 67.59856397048642, 68.14283534658624,
        68.47434924825829, 68.77237088427292, 68.95211748433071, 69.15316965784413, 70.10023844346944,
        68.02433298141146, 68.31970594553175, 67.66158849962935, 67.04621416433453, 67.50624624626471,
        67.26034086655693, 67.94286879964964, 68.9473895392174,
      ]
      const actual = rsi(
        30,
        [
          17134.2, 17145.5, 17154.8, 17141.9, 17141.4, 17160.8, 17166.1, 17155.8, 17157.3, 17166.1, 17211.7, 17187,
          17166.4, 17184.2, 17175.6, 17170.2, 17128.3, 17134.5, 17128.3, 17144.1, 17162.8, 17146.9, 17154.1, 17165.5,
          17171.9, 17173.9, 17180, 17176.5, 17163.9, 17168.3, 17166.1, 17162.6, 17154.7, 17154.6, 17154.2, 17164.7,
          17174.8, 17203.9, 17174.6, 17103.7, 17110.2, 17103.8, 17088.3, 16953.5, 16953.6, 16904.1, 16915.9, 16930.7,
          16947.1, 16937.5, 16923.1, 16938.6, 16960, 16983.7, 16986.9, 16960.2, 16966.7, 17014.6, 17005.8, 17001.5,
          17009.2, 17021.8, 17041.7, 17120.8, 17173.6, 17157.1, 17203.7, 17154.8, 17143.3, 17147.5, 17149.9, 17166.6,
          17184.7, 17150.3, 17162.3, 17159.1, 17422, 17390, 17440.3, 17423.2, 17898.8, 17870.6, 17750.5, 17754, 17642.2,
          17715.8, 17739.1, 17753.2, 17765.7, 17773.1, 17781.2, 17819.5, 17782.7, 17793.9, 17782.5, 17772, 17787.8,
          17783.8, 17806.4, 17840.3,
        ],
      )
      expect(actual).toEqual(expected)
    })
  })
})
